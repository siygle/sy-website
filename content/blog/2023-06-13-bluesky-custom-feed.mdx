---
title: 'å¯¦ä½œ bluesky custom feed'
date: '2023-06-13'
tags: ['bluesky', 'atproto']
draft: false
summary: 'Bluesky æœ€è¿‘é‡‹å‡ºçš„æ–°åŠŸèƒ½ - Custom feed'
authors: ['sy']
---

## å‰è¨€ï¼ˆè®“æˆ‘ murmur ä¸€ä¸‹ï¼‰

è‡ªå¾æ‹¿åˆ° **[bluesky](https://bsky.app/)** ä¹Ÿè©¦ç©ä¸€æ³¢ä¹‹å¾Œï¼Œå®ƒå°±æˆç‚ºç›®å‰è·Ÿ Twitter ä¸¦åˆ—çš„å…©å¤§å¹³å¸¸æˆ‘æœƒä½¿ç”¨çš„ç¤¾äº¤è»Ÿé«”ï¼ˆæŠ±æ­‰äº† mastodonï¼Œå¯¦åœ¨æ²’æœ‰å¤šé¤˜çš„å¿ƒåŠ›å†åˆ†çµ¦ä½ äº†ğŸ˜…ï¼‰ï¼Œä¸éå› ç‚º bluesky ç›®å‰é‚„åœ¨å°æ¸¬æœŸä¹‹ä¸­ï¼Œæ‰€ä»¥å…¶å¯¦è£¡é¢çš„è³‡è¨Šä¸¦æ²’æœ‰å¤ªå¤šï¼Œæ‰€ä»¥æœƒç•™åœ¨ä¸Šé¢ä¸€ä¾†æ˜¯æ˜¯å› ç‚ºå¾ˆå–œæ­¡ç›®å‰ bluesky ä¸Šé¢ç‡Ÿé€ çš„æ–‡åŒ–ï¼ˆé€™éƒ¨åˆ†æˆ‘ä¹‹å‰æœ‰[ç¨å¾®èŠé](https://chat.sylee.dev/2023/04/30/another-callenger-bluesky)ï¼Œå°±ä¸åœ¨é€™é‚Šé‡è¤‡èªªäº†ï¼‰ï¼Œå¦ä¸€éƒ¨åˆ†å°±æ˜¯å®ƒæä¾›äº†ä¸å°‘å¯ä»¥è®“é–‹ç™¼è€…å…œå¼„çš„åœ°æ–¹ï¼Œå…¶ä¸€å°±æ˜¯é€™ç¯‡æƒ³ç¨å¾®æåˆ°çš„ [custom feed](https://blueskyweb.xyz/blog/6-02-2023-beta-update) çš„åŠŸèƒ½ã€‚ğŸ˜„


å®˜æ–¹æœ‰ç‰¹åˆ¥é‡å°é€™å€‹åŠŸèƒ½ï¼Œä»¥åŠèƒŒå¾Œä»–å€‘æ±ºå®šè¦é€™æ¨£è¨­è¨ˆçš„ç†å¿µï¼Œç”¨ä¸€ç¯‡å®˜æ–¹æ–‡ç« ä¾†è§£é‡‹ï¼Œæ‰€ä»¥æœ‰èˆˆè¶£çš„å¯ä»¥é»é¸ä¸‹æ–¹çš„é€™å€‹æ–‡ç« é€£çµå»çœ‹æœƒæ›´æ¸…æ¥šã€‚ï¼ˆ*é€™é‚Šä¹Ÿæƒ³é †å¸¶ä¸€æï¼Œblueskyåœ˜éšŠä¸€å€‹è®“æˆ‘å¾ˆå–œæ­¡çš„ç‰¹è³ªå°±æ˜¯ï¼Œä»–å€‘å¾ˆé¡˜æ„è·Ÿä½¿ç”¨è€…å°è«‡ï¼Œç„¡è«–æ˜¯åœ¨ bluesky å¹³å°ä¸Šã€discord æˆ–æ˜¯å®˜æ–¹çš„æ–‡ç« ï¼Œæ‡‰è©²éƒ½å¯ä»¥æ„Ÿå—åˆ°*ğŸ‘ï¼‰

[![bluesky](https://img-assets.sylee.dev/file/2b8c57951881472c91ee5.png)](https://blueskyweb.xyz/blog/3-30-2023-algorithmic-choice)

ä¸éç†å¿µé€™ç¨®å½¢è€Œä¸Šçš„æ±è¥¿ä¸æ˜¯æˆ‘è¦åœ¨é€™é‚Šè¨è«–çš„æ±è¥¿ï¼Œå› ç‚ºä»–å€‘æœ‰æä¾›å¾ˆæ–¹ä¾¿å…¥é–€çš„æ¨¡æ¿ï¼Œå¯ä»¥è®“æ¯ä½ç¨å¾®æœ‰é–‹ç™¼åº•å­çš„é–‹ç™¼è€…éƒ½å¯ä»¥ä¾†å˜—è©¦å¯¦ä½œè‡ªå·±çš„ custom feedï¼Œèº«ç‚ºç¶²è·¯é»‘æ‰‹ç•¶ç„¶å°é€™ç¨®èƒ½è‡ªå·±å¼„æ±å¼„è¥¿çš„ç‰¹é»æ²’æœ‰æŠµæŠ—åŠ›ğŸ¤£ï¼Œæ‰€ä»¥è‡ªå·±ç©éä¹‹å¾Œç¨å¾®æ•´ç†ä¸€ä¸‹å¿ƒå¾—ã€‚

## Kick-off

> **Bluesky-social/feed-generator**
> https://github.com/bluesky-social/feed-generator

é€™å€‹æ˜¯å®˜æ–¹æä¾›è‡ªè£½ custom feed çš„æ¨¡æ¿ï¼Œç›®å‰æ˜¯ TS/Node çš„å¯¦ä½œï¼Œä¸éä¹Ÿæœ‰ç¤¾ç¾¤å·²ç¶“é–‹ç™¼å‡º [python](https://github.com/MarshalX/bluesky-feed-generator) çš„ç‰ˆæœ¬ï¼Œå‡ä»¥æ™‚æ—¥æ‡‰è©²å„èªè¨€éƒ½æœƒæœ‰é¡ä¼¼çš„æ¨¡æ¿å¯ä»¥ç›´æ¥ä¾›é–‹ç™¼è€…ä½¿ç”¨ã€‚

### é€™é‚Šæœ‰å¹¾å€‹ä½ éœ€è¦å…ˆæº–å‚™å¥½çš„æ±è¥¿ï¼š

1. åŸ·è¡Œæ¨¡æ¿çš„ç›¸é—œå·¥å…·ï¼Œä»¥å®˜æ–¹ç‰ˆæœ¬ä¾†èªªç•¶ç„¶å°±æ˜¯ TypeScript/Node.jsã€‚
2. ä½ éœ€è¦ä¸€å€‹ä½ˆç½²çš„ç©ºé–“ï¼Œç„¡è«–æ˜¯å¾¡ä¸‰å®¶æˆ–æ˜¯ä¸€èˆ¬çš„ VPSï¼Œæˆ–æ˜¯æ›´æ–¹ä¾¿çš„ PaaS éƒ½å¯ä»¥ï¼Œåªè¦å¯ä»¥è·‘èµ·ä¸€å€‹åŸºæœ¬çš„ç¶²è·¯æœå‹™çš„éƒ½å¯ä»¥ã€‚
3. ä¸€å€‹ Bluesky å¸³è™Ÿï¼ˆç•¶ç„¶ğŸ˜†ï¼‰ï¼Œç„¶å¾Œä½ å¯ä»¥å»ç”³è«‹ä¸€çµ„ App passwordï¼Œä¹‹å¾Œç™¼ä½ˆ custom feed çš„æ™‚å€™æœƒç”¨åˆ°ã€‚

### è¸©é›·ä¹‹æ—…ï¼ˆä½ˆç½²å¹³å°ï¼‰

æˆ‘åŸæœ¬æƒ³èª¬æ‰¾å€‹ç°¡å–®çš„ PaaS ä¾†æ”¾å°±å¥½ï¼Œåæ­£ç›®å‰ç®—è©¦ç©æ€§è³ªï¼Œå°±ç®—é¡åº¦ä¸å¤ å°±åœæ‰ä¹Ÿä¸æœƒæ€æ¨£ï¼Œé‡é»æ˜¯å¯ä»¥ä¸ç”¨å†é¡å¤–çš„ç®¡ç†æˆæœ¬ã€‚è‡ªå¾ heroku ç‚¸è£‚ä¹‹å¾Œå¥½åƒå„å®¶äº‚æˆ°ï¼Œä½†ä¼¼ä¹ä¹Ÿæ²’æœ‰ä¸€å€‹å¤§ä¸€çµ±çœŸçš„éå¸¸ä¸éŒ¯çš„å¹³å°å‡ºç¾ï¼ˆå¯èƒ½æ˜¯æˆ‘è‡ªå·±æ²’æœ‰éå¸¸æ³¨æ„ğŸ˜…ï¼‰ã€‚

**fly.io**
ä¸€é–‹å§‹æˆ‘é¸æ“‡äº†è¿‘æœŸè »ç«ç´…çš„ [fly.io](https://fly.io)ï¼Œä¹‹å‰å…¶å¯¦æœ‰è©¦ç”¨éé€™å€‹æœå‹™ï¼Œæœ‰æä¾› CLI æ›´è²¼è¿‘é–‹ç™¼è€…ï¼Œä¸€èˆ¬ PaaS çš„åŠŸèƒ½ä¹Ÿå¹¾ä¹éƒ½æœ‰æä¾›ï¼Œèƒ½æ–¹ä¾¿é€é Github repo çš„ç¶å®šï¼Œä¹Ÿå¯ä»¥é€é CLI ç›´æ¥æ‰“åŒ…ä½ˆç½²ã€‚ä¸éä¸çŸ¥é“æ˜¯ä¸æ˜¯ custom feed æœ‰ä¸€æ®µ websocket çš„è¡Œç‚ºæœƒæ”¶è½æ‰€æœ‰çš„è²¼æ–‡ï¼ˆæ‡‰è©²æ˜¯å…¬é–‹è²¼æ–‡ï¼Ÿå› ç‚ºç›®å‰ bsky ä¹Ÿæ²’æœ‰ç§å¯†è²¼æ–‡ï¼Œä¸çŸ¥é“ä¹‹å¾Œæœƒä¸æœƒæä¾›ï¼‰ï¼Œfly ä¸Šé¢åŸ·è¡Œçš„æœå‹™çš„ API endpoint éƒ½æ²’è¾¦æ³•æ­£å¸¸é‹ä½œï¼Œä¹‹å¾Œåªå¥½æ”¾æ£„ã€‚

**railway**
é€™å€‹æœå‹™å…¶å¯¦ä¸€é–‹å§‹æ˜¯å¾[ç¶²å‹](https://twitter.com/kalanyei/status/1647278789544775680)é‚£é‚Šçœ‹åˆ°çš„ï¼Œç¬¬ä¸€æ¬¡çœ‹åˆ°çš„æ™‚å€™å»è©¦ç”¨å¡é—œäº†ä¸€æ³¢å°±æ”¾æ£„äº†ã€‚é€™æ¬¡å› ç‚º fly çš„å¤±æ•—åˆæƒ³èµ·é€™å€‹æœå‹™ï¼Œç™¼ç¾åŸä¾†æ˜¯æˆ‘å¤ªå°çœ‹å®ƒäº†ğŸ˜±ã€‚

ç•¶ç„¶å¾Œä¾†æœƒé¸ç”¨ Railway ç•¶ç„¶æ˜¯å› ç‚ºå®ƒæ²’æœ‰åƒ fly.io ä¸€æ¨£å¥‡æ€ªçš„ç‹€æ³ï¼Œä¸éå¾Œä¾†æ·±å…¥ç©äº†ä¸€ä¸‹ç™¼ç¾å®ƒçœŸçš„è »å¨çš„ï¼Œå®ƒå€‘è‡ªå·±ç‚ºäº†æ‰“åŒ…ä½ˆç½²å„ç¨®é¡å‹çš„æ‡‰ç”¨ï¼Œè‡ªè¡Œé–‹ç™¼äº†ä¸€å€‹å« **[nixpacks](https://github.com/railwayapp/nixpacks)** çš„å·¥å…·ï¼ˆçœ‹èµ·ä¾†æ˜¯è·Ÿ Nix æ·±åº¦æ•´åˆï¼Œçœ‹èµ·ä¾†å®ƒå€‘æ‡‰è©²æ˜¯æ„›å¥½è€…ï¼Ÿï¼‰ï¼Œèƒ½å¤ è‡ªå‹•æ ¹æ“šæ‡‰ç”¨ç¨‹å¼çš„ç›®éŒ„å…§å®¹ï¼Œç”¢ç”Ÿå‡º OCI æ¨™æº–çš„æ˜ åƒæª”ã€‚

### è¸©é›·ä¹‹æ—…ï¼ˆå®Œæ•´ç™¼ä½ˆ custom feed çš„æµç¨‹ï¼‰

ç›®å‰æ¸¬è©¦ä¹‹å¾Œæˆ‘å¼„äº†ä¸€å€‹ç°¡å–®çš„ [Mandarin Feed](https://bsky.app/profile/did:plc:z57tkg4b3hw7fsn47lud3kf5/feed/mandarin-feed)ï¼Œé¡§åæ€ç¾©å°±æ˜¯éæ¿¾å‡ºåŒ…å«æ¼¢å­—çš„è²¼æ–‡ï¼Œrepo çš„è©±æ˜¯æ”¾åœ¨[é€™é‚Š](https://github.com/siygle/feed-generator)ï¼Œé€™é‚Šæ˜¯æ­é… railway ä½ˆç½²çš„ç°¡å–®æ­¥é©Ÿï¼š

1. Folk [å®˜æ–¹æ¨¡æ¿](https://github.com/bluesky-social/feed-generator)ï¼Œç›´æ¥ç”¨å®˜æ–¹ç‰ˆæœ¬æ˜¯æœ€å¿«çš„ï¼Œç•¶ç„¶ä½ ä¹Ÿå¯ä»¥è‡ªå·±æ‰‹åˆ»å•¦ï¼Œè­¬å¦‚é€™é‚Šæœ‰ [python çš„ç¤¾ç¾¤ç‰ˆæœ¬](https://github.com/MarshalX/bluesky-feed-generator)ï¼Œé‚„æœ‰é–‹ç™¼è€…[åŸºæ–¼ Cloudflare å¹³å°å¯¦ä½œçš„ç‰ˆæœ¬](https://github.com/jcsalterego/Contrails)ã€‚
2. ç‚ºäº†ä½ˆç½²ï¼Œéœ€è¦ç¨å¾®ä¿®æ”¹ä¸€ä¸‹ `npm start` çš„å…§å®¹ï¼ˆå®˜æ–¹æ˜¯ç›´æ¥è·‘ `ts-node src/index.ts`ï¼Œé€™å€‹æœƒé€ æˆæ²’è¾¦æ³•æ­£å¸¸é‹ä½œï¼Œæ”¹æŒ‡åˆ° `node dist/index.js`ï¼Œå¯åƒè€ƒ[é€™é‚Š](https://github.com/siygle/feed-generator/blob/main/package.json#L12)ã€‚
3. `railway up`
4. æœå‹™è·‘èµ·ä¾†ä¹‹å¾Œå°±æ˜¯æŠŠç›¸é—œçš„è³‡æ–™å¡«åˆ° `publishFeed.ts` ç„¶å¾ŒåŸ·è¡Œï¼Œå¦‚æœæ­£å¸¸å°±å¯ä»¥åˆ°è‡ªå·±çš„ profile é é¢å°±æœƒçœ‹åˆ°å‡ºç¾ä¸€å€‹ `feed` çš„é é¢ï¼Œå°±æœƒåœ¨è£¡é¢å•¦ï½

![myFeed](https://img-assets.sylee.dev/file/8d3948bae13bf54b86e12.png)

### è¸©é›·ä¹‹æ—…ï¼ˆå¯¦ä½œ feed çš„è¦å‰‡ï¼‰

ç•¶ç„¶ custom feed æœ€ä¸»è¦æ‡‰è©²é‚„æ˜¯æ‹¿ä¾†å¯¦ä½œè‡ªå·±å¸Œæœ›é”åˆ°çš„ç‰¹åˆ¥è¦å‰‡ã€‚é€™éƒ¨åˆ†çš„å¯¦ä½œä¸»è¦æ˜¯åŒ…å«åœ¨å…©å€‹åœ°æ–¹ï¼š[src/subscription.ts](https://github.com/bluesky-social/feed-generator/blob/main/src/subscription.ts) ä»¥åŠ [src/algos](https://github.com/bluesky-social/feed-generator/blob/main/src/algos/index.ts)ï¼š

* `subscription` -> è¦å­˜å…¥å“ªäº›è³‡æ–™
* `algos` -> è¦å–ä»€éº¼é¡å‹çš„è³‡æ–™

å¤§æ¦‚å°±æ˜¯é€™æ¨£ç°¡å–®å€åˆ†ï¼Œæ‰€ä»¥é–‹ç™¼è€…å¯ä»¥æ ¹æ“šè‡ªå·±çš„ç›®æ¨™ä¾†å¯¦ä½œå°æ‡‰çš„éæ¿¾èˆ‡è¦å‰‡ã€‚ä»¥æˆ‘çš„æ¸¬è©¦ç‰ˆæœ¬ç‚ºä¾‹ï¼Œåªéœ€è¦å­˜ä¸‹åŒ…å«æ¼¢å­—çš„è²¼æ–‡å³å¯ï¼Œæ‰€ä»¥åœ¨ subscription.ts` è£¡é¢çš„éæ¿¾æ¢ä»¶é‚£é‚Šï¼ŒåŠ ä¸Šé‡å°æ¼¢å­—å­—å…ƒçš„æ¯”å°å³å¯ï¼ˆä¸éç›®å‰ Bluesky ä¸Šé¢çš„ä¸­æ–‡ç”¨æˆ¶çœŸçš„éå¸¸å°‘ï¼Œæ‰€ä»¥å¤§å¤šéƒ½çœ‹åˆ°æ—¥æœ¬ä½¿ç”¨è€…ğŸ˜‚ï¼‰

```
    const CHINESE_REG_PATTERN = new RegExp(/[\u4e00-\u9fff\u3400-\u4dbf\u{20000}-\u{2a6df}\u{2a700}-\u{2ebef}\u{30000}-\u{323af}\ufa0e\ufa0f\ufa11\ufa13\ufa14\ufa1f\ufa21\ufa23\ufa24\ufa27\ufa28\ufa29\u3006\u3007][\ufe00-\ufe0f\u{e0100}-\u{e01ef}]?/gmu)

    const postsToCreate = ops.posts.creates
      .filter((create) => {
       // only the posts include Chinese content
        let ret = CHINESE_REG_PATTERN.test(create.record.text)
        return (ret === true)
      })
      .map((create) => {
        // map alf-related posts to a db row
        return {
          uri: create.uri,
          cid: create.cid,
          replyParent: create.record?.reply?.parent.uri ?? null,
          replyRoot: create.record?.reply?.root.uri ?? null,
          indexedAt: new Date().toISOString(),
        }
      })
```

å°±æ˜¯é€™æ¨£ï¼Œæ‰€ä»¥é€éé€™å€‹æ©Ÿåˆ¶ï¼Œæ¯å€‹é–‹ç™¼è€…éƒ½å¯ä»¥è‡ªå·±å¯¦ä½œä¸€äº›ç‰¹åˆ¥çš„ feedï¼Œé€™é‚Šæœ‰[å¾ˆå¤š](https://github.com/skyfeed-dev/feed-generator/blob/main/lib/queries.dart)ç¯„æœ¬å¯ä»¥åƒè€ƒï¼Œä¹‹å¾Œé€éé€™å€‹åŸºç¤æ„Ÿè¦ºå¯ä»¥é‹ç”¨çš„ç©ºé–“ä¸å°‘å‘¢ğŸ˜„ã€‚
				
## FAQ & å°å·¥å…·

### å¥½ç”¨çš„ç¬¬ä¸‰æ–¹

ä¹‹å‰å®˜æ–¹é‚„æ²’æ­£å¼æ”¯æ´çš„æ™‚å€™ï¼Œåªèƒ½é€éä¸€äº›å‹•ä½œæ¯”è¼ƒå¿«çš„ç¬¬ä¸‰æ–¹æ‰èƒ½çœ‹åˆ° custom feedï¼Œé‚£æ™‚å€™ä¸ç¶“æ„è©¦ç”¨åˆ°ä¸€æ¬¾å« [SkyFeed](https://skyfeed.app) çš„ç¬¬ä¸‰æ–¹å®¢æˆ¶ç«¯ï¼Œä¹‹å¾Œå°±å¾ˆç¿’æ…£ä¸€ç›´ç”¨å®ƒäº†ã€‚å®ƒçš„ç‰¹è‰²å°±æ˜¯é‡å° custom feed æœ‰ä¸å°‘å„ªåŒ–çš„è¡Œç‚ºï¼Œé‚„æ”¯æ´å®˜æ–¹å°šæœªæ”¯æ´çš„ hashtag çš„åŠŸèƒ½ã€‚

å¦‚æœä½ æ˜¯è¡Œå‹•è£ç½®æ„›ç”¨è€…çš„è©±ï¼Œé™¤äº†å®˜æ–¹é›™å¹³å°éƒ½å·²ç¶“æ”¯æ´çš„ app ä¹‹å¤–ï¼Œ[graysky](https://graysky.app/)ä¹Ÿéå¸¸ä¸éŒ¯ï¼Œæ¨è–¦ï¼


### æ€éº¼åˆªé™¤æ¸¬è©¦çš„ custom feedï¼Ÿ
å¦‚æœä½ æœ‰è·‘äº†ä¸€æ³¢æ¸¬è©¦ï¼Œå¯èƒ½æœƒç™¼ç¾é€™å€‹å•é¡Œï¼Œå°±æ˜¯ç›®å‰ç¶²é ä¸Šé¢çš„ä»‹é¢ä¸¦æ²’æœ‰æä¾›ä¸€å€‹å¯ä»¥è®“ä½ ã€Œåˆªé™¤ã€å·²ç™¼ä½ˆçš„ custom feed é€™å€‹åŠŸèƒ½ï¼ˆä¸çŸ¥é“ç‚ºä»€éº¼å®˜æ–¹ app å±…ç„¶æ²’æœ‰ç¬¬ä¸€æ™‚é–“æä¾›é€™å€‹åŠŸèƒ½ï¼Œé›£é“ä»–å€‘éƒ½ä¸ç”¨æ¸…æ‰æ¸¬è©¦è³‡æ–™ğŸ¤£ï¼‰ã€‚

ä¸é bsky ä¸Šé¢çš„ç”¨æˆ¶å¾ˆç†±å¿ƒï¼Œç™¼æ–‡ä¹‹å¾Œç«‹åˆ»æ”¶åˆ°æœ‰é–‹ç™¼è€…å·²ç¶“æœ‰å¯¦ä½œé€™å€‹åŠŸèƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œæ‰€ä»¥æœ‰éœ€è¦çš„è©±ï¼Œå¯ä»¥è·³è½‰[é€™è£¡](https://github.com/jcsalterego/Contrails/blob/main/feed-generator/deleteFeedGenerator.ts)ã€‚

## çµèª

æœŸç›¼å¤§å®¶åœ¨å¤©ä¸Šç›¸æœƒ #é• ğŸ‘ğŸ¤£