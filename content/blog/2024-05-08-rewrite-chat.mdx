---
title: 'è€æ˜¯ä½œé‡é€ è¼ªçš„äº‹ - åˆæ”¹äº† chat åˆ†ç«™'
date: '2024-05-08'
tags: ['project', 'fresh', 'deno']
draft: false
summary: 'å› ç‚ºç¨®ç¨®çš„åŸå› ï¼Œåˆæ‰‹ç™¢æŠŠ chat.sylee.dev æ”¹ç‰ˆäº†ï¼Œç„¶å¾Œæ¥é€£ä¸æ–·'
authors: ['sy']
---

_**æˆ‘çŸ¥é“ï¼Œè«å†æ**_ ğŸ˜‚

å¥½ä¸€é™£å­ä¹‹å‰ï¼Œå› ç‚ºä¸€æ™‚çš„å¿ƒè¡€ä¾†æ½®æ‰€ä»¥æŠŠå€‹äººç«™åšäº†ä¸€äº›ä¿®æ”¹ï¼ˆé€™è£¡å°±ä¸è´…è¿°äº†ï¼Œè©³æƒ…åœ¨[é€™é‚Š](https://sylee.dev/blog/2023-04-10-change-again-deno-fresh-webmention)ï¼‰ï¼Œç•¶åˆæŠŠæ¯”è¼ƒæœƒç¶“å¸¸æ€§æ›´æ–°çš„ Newsletter é¡çš„æ–‡ç« æ”¾åˆ°äº† https://chat.sylee.dev é‚£é‚Šï¼Œå› ç‚ºå¸Œæœ›èƒ½ä»¥æœ€æ–¹ä¾¿çš„æ–¹å¼ä¾†å¯«æ–‡ç« ï¼Œæ‰€ä»¥é¸æ“‡äº† **[NotionNext](https://github.com/tangly1024/NotionNext)** é€™å€‹å°ˆæ¡ˆï¼Œå› ç‚ºå®ƒç›´æ¥å°æ¥ Notionï¼Œç„¶å¾Œä½ˆç½²åˆ° Vercel çš„æ–¹æ³•ä¹Ÿéå¸¸æ–¹ä¾¿ï¼Œæ‰€ä»¥å°±åšäº†é€™å€‹é¸æ“‡ï¼Œç¾åœ¨çœ‹èµ·ä¾†ä¹Ÿçš„ç¢ºå¾ˆé©åˆï¼Œæ‰€ä»¥ã€Œ[ç¶²è·¯é»‘æ‰‹çš„å‘¢å–ƒ](https://bsky.app/profile/did:plc:z57tkg4b3hw7fsn47lud3kf5/feed/aaabgg5zdksmg)ã€é€™å€‹ç³»åˆ—æ‰èƒ½ä¸€ç›´å¯«åˆ°ç¾åœ¨é‚„æ²’æ–·æ›´ã€‚

## é‚£åˆ°åº•é€™ç¯‡æ˜¯åˆæ€éº¼äº†ğŸ˜…

å…¶å¯¦æˆ‘é‚„æ˜¯å¾ˆå–œæ­¡ NotionNextï¼Œä¹Ÿå°ç›®å‰é€™å€‹æµç¨‹æ²’ä»€éº¼å¤ªå¤§çš„æ„è¦‹ï¼Œä¸éä¸€åˆ‡éƒ½è¦å¾ Next.js å‡ç´šé–‹å§‹èªªèµ·ï¼ˆä¹Ÿå°±æ˜¯ NotionNext 4.xï¼‰ï¼Œå› ç‚ºå‡ç´šä¹‹å¾ŒåŸæœ¬æäº¤çš„ä¸€å€‹æ–‡ç« è‡ªè¨‚é€£çµçš„åŠŸèƒ½ï¼Œå› ç‚ºæ”¹å¯«ä¹‹å¾Œçš„æ¶æ§‹è®Šæˆç„¡æ³•å¯¦ç¾ï¼ˆä½œè€…å·²ç¶“æŠŠåŸæœ¬çš„ issue æ”¹æˆ discussion [æ”¾åˆ°é€™é‚Š](https://github.com/tangly1024/NotionNext/discussions/1973)äº†ï¼Œçœ‹èµ·ä¾†çŸ­æ™‚é–“ä¹‹å…§æ‡‰è©²ä¸æœƒè™•ç†ï¼‰ï¼Œå°è‡´æˆ‘å¾—æŠŠå°ˆæ¡ˆçš„ç‰ˆæœ¬å®šæ­»åˆ°æŸå€‹ç‰ˆæœ¬è™Ÿä¸èƒ½å†ç¹¼çºŒè·Ÿä¸Š upstream äº†ï¼Œé€™å€‹ç‹€æ³ä¸€é–‹å§‹é‚„æ²’ä»€éº¼ï¼Œä¸éæ™‚é–“ä¸€ä¹…ï¼Œé™¤äº†ä¸€äº›å®‰å…¨æ€§æ›´æ–°ä¹Ÿç„¡æ³•é †åˆ©çš„è£œä¸Šï¼Œé‚„å¯èƒ½é‡åˆ°å°ˆæ¡ˆç‰ˆæœ¬è¡çªçš„å•é¡Œï¼Œæ‰€ä»¥é–‹å§‹èŒç”Ÿæ˜¯ä¸æ˜¯è¦å†æ‰¾ä¸€å€‹å…¶ä»–æ›¿ä»£æ–¹æ¡ˆã€‚

é›–ç„¶æ˜¯æƒ³æ‰¾æ›¿ä»£ï¼Œä¸éæˆ‘é‚„æ˜¯å¸Œæœ›ç¶­æŒ Notion ä½œç‚º CMS çš„é¡ä¼¼æ–¹æ¡ˆï¼Œæ‰€ä»¥ç¨å¾®çœ‹äº†ä¸‹æœ‰æ²’æœ‰é¡ä¼¼åŠŸèƒ½çš„å°ˆæ¡ˆï¼ˆè­¬å¦‚ [astro-notion-blog](https://github.com/otoyo/astro-notion-blog)ã€[vue-notion](https://github.com/janniks/vue-notion)ï¼‰ï¼Œä½†è¦ºå¾—éƒ½æ²’æœ‰å¾ˆç¬¦åˆè‡ªå·±çš„éœ€è¦ â¬‡ï¸

* astro å¤ªæ½®æ²’æœ‰å¿ƒåŠ›å†å¤šé–‹æˆ°ç·šï¼Œè€Œä¸”å®ƒåå‘éœæ…‹å…§å®¹ï¼Œæœ‰ç•™æ„åˆ°é–‹ç™¼è€…æåˆ°æ–‡ç« å¤šäº†ä¹‹å¾Œï¼Œ[ç·¨è­¯çš„æ™‚é–“æœƒè®Šå¾ˆé•·](https://alpacat.com/posts/migrated-alpacalog-to-n2b)ï¼Œæ‰€ä»¥å¾Œä¾†ä»–ä¹Ÿæ”¹ç”¨è‡ªå·±é–‹ç™¼çš„ç³»çµ±ã€‚
* vue ç”Ÿæ…‹é›–ç„¶å¥½å¯«å®¹æ˜“ä¸Šæ‰‹ï¼Œä½†æ˜¯å¯èƒ½é€™é¡çš„éœ€æ±‚å¾ˆå°çœ¾ï¼Œæ‰€ä»¥çœ‹ç›¸é—œçš„æ±è¥¿ä¸å¤šï¼Œé€£ render éƒ½ä¸æ˜¯å¾ˆå®Œæ•´ï¼Œç„¶å¾Œå¥½åƒä¹Ÿéƒ½æ²’ä»€éº¼å†æŒçºŒç¶­è­·é–‹ç™¼çš„æ¨£å­ã€‚

## æ‰€ä»¥åˆèµ°ä¸Šé€™æ¢è·¯

æœ€å¾Œæ±ºå®šå› ç‚ºè¿‘æœŸæ„›ç”¨çš„ Denoï¼Œåˆæ’¿èµ·ä»–å€‘å®¶å‡ºå“çš„ [Fresh](https://fresh.deno.dev) ä¾†æ”¹æ”¹çœ‹ï¼Œç„¶å¾Œå°±è®Šæˆé€™æ¨£äº†ğŸ˜‚ï¼Œç›®å‰éå¸¸é™½æ˜¥çš„ç‰ˆæœ¬åªæœ‰å…©å€‹è¦æ±‚ï¼š

1. ç›¸å®¹åŸæœ¬ NotionNext çš„æ–‡ä»¶æ ¼å¼ï¼ˆç‚ºäº†ç„¡ç—›è½‰ç§»ï¼‰
2. æ»¿è¶³æœ€åŸºæœ¬çš„æ–‡ç« æ ¼å¼é¡¯ç¤ºï¼ˆNotionNext å…¶å¯¦åŠŸèƒ½éå¸¸å¼·å¤§ï¼Œæˆ‘ä¹Ÿæ²’æ‰“ç®—ä½œ 100% çš„ç§»æ¤ï¼Œè‡ªå·±å¯«æ–‡çš„ç”¨é€”ï¼Œæœ€æ—©æœŸåªè¦èƒ½æ”¯æ´ Notion æ ¼å¼çš„æ­£å¸¸é¡¯ç¤ºå°±å¤ ï¼‰ã€‚

å¦‚æœæ²’è½é Fresh æ˜¯ä»€éº¼çš„è©±ï¼Œä¹‹å‰[ã€Œæœ¬ç«™æ”¹ç‰ˆé‚£ç¯‡ã€](https://sylee.dev/blog/2023-04-10-change-again-deno-fresh-webmention)æœ‰ç¨å¾®æåŠï¼Œç°¡å–®èªªå°±æ˜¯ Deno å®¶è‡ªæ¨çš„ SSR æ¡†æ¶ï¼Œæ‰€ä»¥å¯ä»¥å®Œç¾ç›¸å®¹ Deno ä»¥åŠ Deno Deploy çš„ä½ˆç½²ï¼ˆæ˜¯çš„ï¼Œæ”¹ç‰ˆå¾Œçš„ chat ä¹Ÿå¾ Vercel æ”¹åˆ° [Deno Deploy](https://deno.com/deploy) å•¦ï¼‰ã€‚

### å¡é—œä¸€ï¼šæ”¯æ´ Notion æ ¼å¼çš„æ­£å¸¸é¡¯ç¤º

ç¬¬ä¸€å€‹é‡åˆ°çš„å•é¡Œï¼Œå°±æ˜¯å¦‚ä½•ã€Œæ­£ç¢ºåœ°é¡¯ç¤º Notion çš„æ–‡ç« æ ¼å¼ã€ï¼Œèª å¦‚å‰é¢æåŠå¦‚ vue-notion é€™é¡çš„å·¥å…·ï¼Œä¸éæ‰¾äº†ä¸€è¼ªè¦ä¸æ˜¯æ¡†æ¶ç”Ÿæ…‹åœˆå¤ªå°çœ¾ï¼Œä¸ç„¶å°±æ˜¯å¯¦ä½œæ²’é‚£éº¼å®Œæ•´ï¼Œæ‰€ä»¥å¾Œä¾†é‚„æ˜¯å›åˆ° React ç”Ÿæ…‹åœˆï¼Œç”¨è·Ÿ NotionNext ä¸€æ¨£çš„è§£æ³• - [react-notion-x](https://github.com/NotionX/react-notion-x)ã€‚

*å‚™è¨»ï¼šçœŸçš„å¾ˆæ„Ÿè¬é€™ä½é–‹ç™¼è€…å¯¦ä½œäº†é€™å€‹å¥—ä»¶ï¼Œå¹¾ä¹æ”¯æ´äº†å¤§å¤šæ•¸çš„ Notion æ–‡ç« æ ¼å¼ï¼Œé‚„åŒ…å«äº† Notion API clientï¼Œä»¥åŠä¸€äº›è³‡æ–™è™•ç†æœƒç”¨åˆ°çš„å°å·¥å…·ã€‚æ¯”è¼ƒå¥‡è€™çš„æ˜¯ç•¶åˆé–‹ç™¼çš„æ™‚å€™æ‡‰è©²é‚„æ²’æœ‰ Notion å®˜æ–¹çš„ APIï¼Œæ‰€ä»¥å®ƒçš„å®¢æˆ¶ç«¯æ˜¯ç”¨ private API ä½œçš„ï¼Œç¸½è¦ºå¾—æ‡‰è©²æ”¹æˆæ­£å¼ API æœƒæ¯”è¼ƒå¥½ï¼Œæˆ–è¨±å¯ä»¥æå€‹ PRï¼Œä½†æˆ‘ä¸æ•¢äº‚ç«‹ flag ğŸ¤£ã€‚*

é›–ç„¶ fresh æ˜¯åŸºæ–¼ [preactjs](https://preactjs.com/) ä¸éå®ƒç›¸ç•¶ç¨‹åº¦ç›¸å®¹ Reactï¼Œæ‰€ä»¥ä½¿ç”¨ä¸Šæ²’æœ‰å¤ªå¤§çš„å•é¡Œï¼Œè¨˜å¾—æŠŠ react-notion-x çš„ redener å¯¦ä½œåœ¨ [islands](https://fresh.deno.dev/docs/concepts/islands) è£¡é¢å³å¯ã€‚

### å¡é—œäºŒï¼šæ•´åˆ react-notion-x ç¬¬ä¸‰æ–¹å¥—ä»¶

èƒ½å¤ é¡¯ç¤ºåŸºæœ¬çš„ Notion æ–‡ç« æ ¼å¼ä¹‹å¾Œé‡åˆ°çš„ç¬¬äºŒå€‹å•é¡Œï¼Œå°±æ˜¯æ”¯æ´æ¨æ–‡çš„é¡¯ç¤ºï¼Œé€™é‚Šä¸€æ¨£åƒè€ƒ NotionNext çš„å¯¦ä½œï¼Œä¸€æ¨£åŠ ä¸Šäº† [react-tweet-embed](https://github.com/tangly1024/NotionNext/blob/main/components/NotionPage.js#L42)ï¼Œä¹Ÿåƒè€ƒäº†å®ƒçš„å¯¦ä½œæ–¹å¼ã€‚

ä¸éæŠ˜é¨°å¥½ä¸€æ®µæ™‚é–“ï¼Œéƒ½æ²’è¾¦æ³•æ­£å¸¸é¡¯ç¤ºæ¨æ–‡ï¼Œå¾Œä¾†ä¸€å€‹éˆå…‰é–ƒç¾æƒ³èµ·ä¸€å€‹é—œéµçš„å•é¡Œ - **â€Œå¥—ä»¶ç›¸ä¾æ€§**ã€‚å› ç‚ºå¥½ä¸€é™£å­æ²’å¥½å¥½å¯«å‰ç«¯çš„æ±è¥¿ï¼Œæœ‰äº›æ±è¥¿éƒ½å¿˜äº†ã€‚é€™é‚Šè¦ç‰¹åˆ¥æ¨è–¦ä¸€å€‹å¥½ç”¨çš„å·¥å…· - [esm.sh](https://esm.sh)ï¼Œå°¤å…¶å¦‚æœä½ ä¹Ÿæ‰“ç®—ç”¨ fresh çš„è©±ã€‚

**esm.sh** æ˜¯ä¸€å€‹é¡ä¼¼ CDN çš„æœå‹™ï¼Œä¸éå®ƒä¸å–®åªæœ‰é€™å€‹åŠŸèƒ½è€Œå·²ï¼Œä»–æ‡‰è©²èªªæ˜¯ Deno å‰ç«¯é–‹ç™¼çš„å¿…å‚™å·¥å…·ä¹‹ä¸€ã€‚å¦‚æœå° Deno æœ‰ç¨å¾®ç ”ç©¶çš„æ‡‰è©²éƒ½çŸ¥é“ï¼Œåœ¨ä¸€é–‹å§‹å®ƒå€‘å¹¾ä¹å®Œå…¨æ“æŠ± [modules import](https://docs.deno.com/runtime/manual/basics/modules/) çš„ï¼Œæ‰€ä»¥ç¶“å¸¸å¯ä»¥çœ‹åˆ°åƒä¸‹åˆ—é€™ç¨®ï¼š

```
import {
  add,
  multiply,
} from "https://x.nest.land/ramda@0.27.0/source/index.js";
```

ä¸éé™¤äº†æä¾›åƒä¸€èˆ¬ CDN çš„åŠŸèƒ½ä¹‹å¤–ï¼Œesm.sh æœ‰ä¸€äº›æ¯”è¼ƒç‰¹åˆ¥çš„åŠŸèƒ½ï¼Œè­¬å¦‚åƒç›´æ¥æ”¯æ´å®‰è£ npmã€Github å¥—ä»¶ã€è™•ç†ç›¸ä¾ã€æ”¯æ´ worker ç­‰é‚„æœ‰å¾ˆå¤šå¼·å¤§çš„åŠŸèƒ½ï¼Œå¯ä»¥[åƒè€ƒæ–‡ä»¶éƒ½æœ‰è©³ç´°çš„èªªæ˜](https://esm.sh/#docs)ï¼Œéƒ½å¯ä»¥é€éç¶²å€åƒæ•¸ç›´æ¥åšåˆ°ï¼Œæ‰€ä»¥å¾Œä¾†å°±æ˜¯ç”¨ä¸‹åˆ—çš„æ–¹æ³•è§£æ±ºé‡åˆ°çš„å„ç¨®å•é¡Œï¼š

```
{
    "preact": "https://esm.sh/preact@10.20.2",
    "preact-render-to-string": "https://esm.sh/*preact-render-to-string@6.4.2",
    "react": "https://esm.sh/preact@10.20.2/compat",
    "react-dom": "https://esm.sh/preact@10.20.2/compat",
    "react-notion-x": "https://esm.sh/react-notion-x@6.16.0?external=react,react-dom",
    "react-tweet-embed": "https://esm.sh/react-tweet-embed@2.0.0?external=react"
}
```

å‰é¢æé preactjs æ˜¯ç›¸å®¹ react çš„ï¼Œæ‰€ä»¥è¨˜å¾—æŠŠç›¸å®¹çš„éƒ¨åˆ†è¨­å®šå¥½ï¼ˆå…¶å¯¦é€™é‚Šä¹Ÿå¯ä»¥ç”¨ `alias` çš„åŠŸèƒ½ä¾†è™•ç† â¬‡ï¸

```
"react": "https://esm.sh/preact@10.20.2/compat",
"react-dom": "https://esm.sh/preact@10.20.2/compat",    
```

ç„¶å¾Œé‡å°é‚£äº›ç›¸ä¾çš„å¥—ä»¶ï¼ŒæŒ‡å®šä¾è³´ç‚ºä¸Šè¿°çš„ `react` & `react-dom`

```
"react-notion-x": "https://esm.sh/react-notion-x@6.16.0?external=react,react-dom",
"react-tweet-embed": "https://esm.sh/react-tweet-embed@2.0.0?external=react",
```

`external` æ˜¯æŒ‡æ‹¿åŒå°ˆæ¡ˆå·²å­˜åœ¨çš„å…¶ä»–å¥—ä»¶ï¼ˆåƒ Deno å°ˆæ¡ˆä¸­å®šç¾©åœ¨ **import-maps** è£¡é¢çš„å…¶ä»–å¥—ä»¶ï¼‰ï¼Œå¦‚æœæƒ³ç›´æ¥å¼•å…¥ç›¸ä¾çš„å…¶ä»–å¥—ä»¶ï¼Œå¯ä»¥æ”¹ç”¨ `deps=react,react-dom` ä¾†è™•ç†ã€‚

é€™æ¨£å¤šæ•¸å•é¡Œå°±è§£æ±ºäº†ï¼Œå…¶ä¸­é‚„é‡åˆ°ä¸€å€‹æ”¯æ´ pdf æª”æ¡ˆçš„å»¶ä¼¸å•é¡Œï¼Œåœ¨ react-notion-x è£¡é¢æ˜¯æ”¾åœ¨éœ€è¦è‡ªå·±é¡å¤–å¼•å…¥çš„åŠŸèƒ½ï¼Œé€™éƒ¨åˆ†å€’ä¸é›£è™•ç†ï¼Œå› ç‚º esm.sh ä¹Ÿæ˜¯æ”¯æ´è‡ªè¨‚è·¯å¾‘çš„å¼•å…¥ï¼ˆå¦‚ä¸‹ï¼Œ`/build/third-party/pdf` é€™æ®µï¼‰ï¼Œä¸éé‚„æœ‰å€‹æ¯”è¼ƒå¤§çš„å•é¡Œæ˜¯å®ƒä¾è³´çš„ [`react-pdf`](https://www.npmjs.com/package/react-pdf) æ˜¯åˆ©ç”¨ web worker ä¾†åŸ·è¡Œçš„ï¼Œçµæœæ²’æƒ³åˆ° esm.sh ä¹Ÿå·²ç¶“æ”¯æ´é€™å€‹åŠŸèƒ½äº†ï¼ˆ`?worker`ã€‚ğŸ˜

```
"react-notion-x-pdf": "https://esm.sh/react-notion-x@6.16.0/build/third-party/pdf?external=react&deps=react-pdf@5.7.1&worker",
```

åœ¨ Deno ç”Ÿæ…‹ä¸­é–‹ç™¼å‰ç«¯ç›¸é—œåŠŸèƒ½ï¼ŒçœŸçš„ä¸è¦éŒ¯é esm.sh é€™å€‹æ–¹ä¾¿åˆå¼·å¤§çš„å·¥å…·ã€‚

## çµèª

ä¹‹å¾Œæ•´ç†ä¹‹å¾ŒæœƒæŠŠå°ˆæ¡ˆé–‹æºå‡ºä¾†ï¼Œå¦‚æœæƒ³ä½¿ç”¨é¡ä¼¼çš„å¯«ä½œæ¨¡å¼ & æŠ€è¡“æ£§çš„è©±å¯ä»¥è©¦ç”¨çœ‹çœ‹ã€‚ä¹‹å¾Œæ‡‰è©²é‚„æœƒæœ‰ä¸€äº›å¾…ä½œäº‹é …ï¼Œä¸éæˆ‘æ€•å› ç‚ºä¸å½±éŸ¿ä¸€èˆ¬ç™¼æ–‡ï¼Œå°±æ²’å‹•åŠ›ç¹¼çºŒäº†ğŸ˜…ï¼Œç›®å‰æƒ³åˆ°çš„æœ‰ï¼š

* å®Œæ•´æ•´åˆ react-notion-x çš„åŠŸèƒ½ï¼ˆç›®å‰åªæœ‰åŸºæœ¬æ ¼å¼è·Ÿ Tweetï¼‰ã€‚  
* æ”¯æ´ sitemapsï¼ˆé€™å€‹å¯èƒ½è¦ç­‰ fresh æœ‰ä»€éº¼è§£æ±ºæ–¹æ¡ˆæ‰è¡Œï¼Œå¾…å›è¦†ï¼‰ã€‚
* æ•ˆèƒ½èª¿æ ¡ & å„ç¨®å„ªåŒ–ï¼ˆä¸€çœ‹å°±çŸ¥é“ç›®å‰çœŸçš„éå¸¸é™½æ˜¥ï¼‰ã€‚ 
* å›è¦†è©•è«–åŠŸèƒ½ï¼ˆ[WebMention](https://webmention.io/) è·Ÿå…ˆå‰ä¸€æ¨£ï¼Œæ‰€ä»¥æŠ“ä¹‹å‰ profile ç«™ç§»æ¤éä¾†ï¼Œæœ€è¿‘å®ƒå·²ç¶“æ”¯æ´ BlueSky æ‰€ä»¥å°æˆ‘è¶³çŸ£ï¼Œä¹‹å¾Œå¯èƒ½å†è£œä¸Šæ”¯æ´ [utterances](https://github.com/utterance/utterances)ï¼Œä¸éç¾åœ¨å¤§å®¶éƒ½ä¸å¤ªæœ‰å›è¦†æ°ç‰¹çš„ç¿’æ…£äº†ï¼Œå¥½æ‡·å¿µä»¥å‰çš„æ™‚ä»£é˜¿ï½ï¼‰ã€‚  
* æ¨¡æ¿ä¸»é¡Œï¼ˆé€™æ‡‰è©²æ¬Šé‡æœƒéå¸¸ä½ï¼Œå› ç‚ºå°å‰ç«¯èœæ‰‹çš„æˆ‘æœ‰é»å›°é›£ï¼‰ã€‚

Flag ä¸è¦ç«‹å¤ªå¤šå…ˆé€™æ¨£å°±å¥½ï¼Œèªªä¸å®šä¹Ÿæ ¹æœ¬ä¸æœƒé€²è¡Œ...å“ˆã€‚

>
> æ‰€ä»¥æ­¡è¿å¤§å®¶ç¹¼çºŒä¾† https://chat.sylee.dev æ°ç‰¹
>
> by æ‰‹ç™¢çš„è€ç«™é•· ğŸ˜

