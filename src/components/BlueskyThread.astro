---
import type { BlueskyPost } from '~/lib/bluesky';
import BlueskyPostComponent from './BlueskyPost.astro';

interface Props {
  posts: BlueskyPost[];
  showDate?: boolean;
}

const { posts, showDate = false } = Astro.props;

// Format the thread date (from the last post)
function formatThreadDate(dateString: string): string {
  const date = new Date(dateString);
  return date.toLocaleDateString('en-US', {
    weekday: 'short',
    month: 'short',
    day: 'numeric',
    hour: 'numeric',
    minute: '2-digit',
  });
}

const lastPost = posts[posts.length - 1];
---

<div class="relative bg-white border border-gray-200 rounded-lg p-4 hover:border-gray-300 transition-colors">
  <!-- Thread date and indicator -->
  <div class="flex items-center justify-between mb-4">
    {showDate && lastPost && (
      <span class="text-xs text-gray-400">
        {formatThreadDate(lastPost.record.createdAt)}
      </span>
    )}
    <div class="flex items-center gap-2 text-sm text-gray-500">
      <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z" />
      </svg>
      <span>Thread with {posts.length} posts</span>
    </div>
  </div>

  <!-- Vertical connector line -->
  <div class="absolute left-9 top-16 bottom-8 w-0.5 bg-gray-200" />

  <!-- Thread posts -->
  <div class="space-y-3">
    {posts.map((post, index) => (
      <BlueskyPostComponent
        post={post}
        isInThread={true}
        showConnector={index < posts.length - 1}
      />
    ))}
  </div>
</div>
